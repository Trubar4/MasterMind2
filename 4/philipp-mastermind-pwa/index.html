<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Philipp's Mastermind</title>
  <link rel="stylesheet" href="styles.css" id="styles-link" />
  <link rel="manifest" href="manifest.json" id="manifest-link" />
  <meta name="theme-color" content="#F5F5F5" />
  <link rel="apple-touch-icon" href="icons/icon-192.png" />  
</head>
<body>
  <div class="container">
    <div class="top-bar">
      <h1>Philipp's Mastermind</h1>
      <div class="language-switcher">
        <!-- Set DE active by default -->
        <span class="lang-option" data-lang="en">EN</span>
        <span class="lang-separator">|</span>
        <span class="lang-option active" data-lang="de">DE</span>
      </div>
    </div>
    
    <!-- New 4-column header layout -->
    <div class="header">
      <div class="colors-header">
        <span class="translatable" data-key="colours">Farben</span>
      </div>
      <div class="positions-header">
        <span class="translatable" data-key="positions">Positionen</span>
      </div>
    </div>
    
    <!-- The board will be built by JavaScript -->
    <div id="board"></div>
    
    <!-- New 4-column roles layout -->
    <div class="roles">
      <span id="codemaker-label" class="active translatable" data-key="codemaker">ERSTELLER</span>
      <span id="codebreaker-label" class="translatable" data-key="codebreaker">LÃ–SER</span>
    </div>
    
    <!-- New 4-column controls layout -->
    <div class="controls">
      <button id="new-gamebtn" class="translatable" data-key="newGame">Neues Spiel</button>
      <!-- The guess area for codemaker -->
      <div id="guess-area"></div>
      <button id="submitbtn" class="translatable" data-key="submit" disabled>Senden</button>
    </div>
    
    <!-- Mode picker -->
    <div id="modepicker" class="hidden">
      <!-- Mode options will be generated by JavaScript -->
    </div>
  </div>
  
  <!-- Color picker -->
  <div id="color-picker" class="color-picker hidden">
    <div class="colors">
      <!-- Color options will be generated by JavaScript -->
    </div>
    <div class="triangle"></div>
  </div>
  
  <!-- Load diagnostic script -->
  <script>
    // Add diagnostic information
    console.log('Diagnostic script loaded');
    console.log('Browser information:', navigator.userAgent);
    
    // Check if the page is being served over HTTP/HTTPS or from file
    console.log('Page location:', window.location.href);
    
    // Check if ES6 modules are supported
    let modulesSupported = false;
    try {
      new Function('import("")');
      modulesSupported = true;
    } catch (err) {
      console.error('ES6 modules not supported:', err);
    }
    console.log('ES6 modules supported:', modulesSupported);
    
    // Add a visible message for debugging
    function showDebugMessage(message) {
      const debugDiv = document.createElement('div');
      debugDiv.style.position = 'fixed';
      debugDiv.style.top = '0';
      debugDiv.style.left = '0';
      debugDiv.style.right = '0';
      debugDiv.style.padding = '10px';
      debugDiv.style.backgroundColor = 'red';
      debugDiv.style.color = 'white';
      debugDiv.style.zIndex = '10000';
      debugDiv.style.textAlign = 'center';
      debugDiv.textContent = message;
      document.body.appendChild(debugDiv);
    }
    
    // Show if there's a loading issue
    window.addEventListener('error', function(e) {
      console.error('Global error:', e.message, e.filename, e.lineno);
      showDebugMessage('Error: ' + e.message);
    });
    
    // Test if basic DOM manipulation works
    try {
      document.getElementById('new-gamebtn').addEventListener('click', function() {
        alert('New game button clicked');
      });
      console.log('Basic event listener added successfully');
    } catch (err) {
      console.error('Failed to add event listener:', err);
      showDebugMessage('Failed to attach events: ' + err.message);
    }
  </script>
  
  <!-- Try to load using ES modules (might fail in some environments) -->
  <script type="module">
    import { APP_VERSION } from './js/config.js';
    console.log('ES6 module loaded successfully! App version:', APP_VERSION);
    
    // If we get here, modules are working
    const moduleStatusDiv = document.createElement('div');
    moduleStatusDiv.style.position = 'fixed';
    moduleStatusDiv.style.bottom = '0';
    moduleStatusDiv.style.left = '0';
    moduleStatusDiv.style.right = '0';
    moduleStatusDiv.style.padding = '10px';
    moduleStatusDiv.style.backgroundColor = 'green';
    moduleStatusDiv.style.color = 'white';
    moduleStatusDiv.style.zIndex = '10000';
    moduleStatusDiv.style.textAlign = 'center';
    moduleStatusDiv.textContent = 'ES6 Modules loaded successfully';
    document.body.appendChild(moduleStatusDiv);
    
    // Continue with app initialization
    import('./js/app.js').catch(err => {
      console.error('Failed to load app.js:', err);
      moduleStatusDiv.style.backgroundColor = 'orange';
      moduleStatusDiv.textContent = 'Module partially loaded - app.js failed: ' + err.message;
    });
  </script>
  
    <!-- Fallback to original script if needed -->
  <script>
    // Wait to see if modules load correctly
    setTimeout(function() {
      if (!window.modulesLoaded) {
        console.log('Falling back to original script.js');
        showDebugMessage('Module loading failed - falling back to original script');
        
        // Load the original script as fallback
        const script = document.createElement('script');
        script.src = 'script.js';
        script.onerror = function() {
          console.error('Failed to load fallback script');
          showDebugMessage('Failed to load fallback script.js');
        };
        document.body.appendChild(script);
      }
    }, 2000);
  </script>

</body>
</html>